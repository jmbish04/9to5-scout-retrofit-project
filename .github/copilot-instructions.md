# 9to5-scout - AI-Powered Resume & Cover Letter Generator

9to5-scout is a TypeScript Cloudflare Worker application that provides AI-driven resume and cover letter generation APIs using Cloudflare's Workers AI. The application processes job descriptions and candidate information to generate tailored documents via REST API endpoints.

Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.

## Working Effectively

### Bootstrap and Build the Repository

Run these commands in exact order to set up the development environment:

```bash
# Install pnpm globally if not available
npm install -g pnpm

# Install project dependencies
cd /home/runner/work/9to5-scout/9to5-scout
pnpm install
```

**NEVER CANCEL**: Dependency installation takes up to 5 minutes. Set timeout to 10+ minutes.

### Core Build Commands

**CRITICAL**: All build commands are fast (~2 seconds) but set appropriate timeouts as a safety measure:

```bash
# Generate Cloudflare Worker types from wrangler.toml
pnpm generate-types
# Takes: ~1 second. Set timeout to 30+ seconds.

# Type checking with automatic type generation
pnpm typecheck  
# Takes: ~2 seconds. Set timeout to 60+ seconds.

# Build the worker (includes type generation)
pnpm build
# Takes: ~2 seconds. Set timeout to 60+ seconds.
```

**NEVER CANCEL**: Always wait for builds to complete. Though fast, network issues may extend build times.

### Development Server

**CRITICAL LIMITATION**: Local development server requires Cloudflare authentication due to Browser Rendering and AI bindings.

```bash
# This WILL FAIL locally due to Browser Rendering dependency
pnpm dev
# Error: "Browser Rendering is not supported locally"

# Remote development requires authentication
pnpm wrangler dev --remote
# Error: "You must be logged in to use wrangler dev in remote mode"
```

**DO NOT attempt to run the development server locally**. The application requires Cloudflare's remote AI services and browser rendering which are not available in local development mode.

## API Validation

### Manual Testing Requirements

Since local development is not possible, validate changes using these manual test scenarios:

#### Test Data for API Validation

```bash
# Cover Letter Test Data
cover_letter_data='{
  "job_title": "Senior Product Manager",
  "company_name": "TechCorp Inc",
  "hiring_manager_name": "Jane Smith", 
  "job_description_text": "We are looking for a Senior Product Manager to lead our AI initiatives and drive product strategy.",
  "candidate_career_summary": "Experienced Product Manager with 8+ years leading cross-functional teams and launching successful products."
}'

# Resume Test Data  
resume_data='{
  "job_title": "Senior Product Manager",
  "company_name": "TechCorp Inc",
  "job_description_text": "We are looking for a Senior Product Manager to lead our AI initiatives and drive product strategy.",
  "candidate_career_summary": "Experienced Product Manager with 8+ years leading cross-functional teams and launching successful products."
}'
```

#### Required Validation Steps After Changes

**ALWAYS** perform these validation steps after making any code changes:

1. **Build Validation**: `pnpm build` must succeed without errors
2. **Type Validation**: `pnpm typecheck` must pass completely
3. **API Structure Validation**: Review generated types in `worker-configuration.d.ts`
4. **Template Validation**: Verify HTML templates in `public/` directory contain expected placeholders

#### API Endpoint Testing (Remote Only)

If you have access to a deployed version, test these scenarios:

```bash
# Test cover letter endpoint
curl -X POST https://your-worker.dev/api/cover-letter \
  -H 'Content-Type: application/json' \
  -d "$cover_letter_data"

# Test resume endpoint  
curl -X POST https://your-worker.dev/api/resume \
  -H 'Content-Type: application/json' \
  -d "$resume_data"

# Test invalid method (should return 405)
curl -X GET https://your-worker.dev/api/cover-letter

# Test missing fields (should return 400)
curl -X POST https://your-worker.dev/api/cover-letter \
  -H 'Content-Type: application/json' \
  -d '{}'
```

## Key Project Files and Structure

### Critical Files to Always Check After Changes

- `src/index.ts` - Main worker code with API endpoints
- `wrangler.toml` - Cloudflare Worker configuration with bindings
- `worker-configuration.d.ts` - Generated types (regenerated by builds)
- `public/resume_template.html` - Resume HTML template
- `public/template_cover_letter.html` - Cover letter HTML template
- `package.json` - Dependencies and scripts
- `tsconfig.json` - TypeScript configuration

### Repository Structure

```
/home/runner/work/9to5-scout/9to5-scout/
├── src/
│   └── index.ts                      # Main Worker application
├── public/
│   ├── resume_template.html          # Resume HTML template
│   └── template_cover_letter.html    # Cover letter HTML template
├── .agents/                          # Agent configuration (not part of main app)
├── dist/                             # Build output (generated)
├── package.json                      # Dependencies and scripts
├── pnpm-lock.yaml                    # Dependency lock file
├── tsconfig.json                     # TypeScript configuration
├── wrangler.toml                     # Cloudflare Worker configuration
└── worker-configuration.d.ts        # Generated types
```

### Available Scripts

```json
{
  "generate-types": "wrangler types",
  "typecheck": "pnpm generate-types && tsc -p tsconfig.json", 
  "build": "pnpm generate-types && wrangler build",
  "dev": "wrangler dev"
}
```

## Cloudflare Worker Configuration

### Environment Bindings

The worker has access to these Cloudflare bindings (configured in `wrangler.toml`):

- **AI**: Cloudflare Workers AI for text generation
- **MYBROWSER**: Browser Rendering for web scraping  
- **DB**: D1 Database for data storage
- **KV**: Key-Value storage
- **R2**: Object storage
- **VECTORIZE_INDEX**: Vector database for embeddings
- **Durable Objects**: SITE_CRAWLER, JOB_MONITOR
- **Workflows**: Discovery, JobMonitor, ChangeAnalysis

### API Endpoints

1. **POST `/api/cover-letter`**
   - Generates AI-powered cover letters
   - Required fields: `job_title`, `company_name`, `job_description_text`, `candidate_career_summary`
   - Optional: `hiring_manager_name`

2. **POST `/api/resume`**
   - Generates AI-powered resume content
   - Required fields: `job_title`, `company_name`, `job_description_text`, `candidate_career_summary`

## Common Development Tasks

### Making Code Changes

1. **ALWAYS** run `pnpm typecheck` before making changes to understand current state
2. Make minimal, focused changes to `src/index.ts` or templates
3. **IMMEDIATELY** run `pnpm build` after changes to verify compilation
4. **ALWAYS** run `pnpm typecheck` again to ensure no type errors
5. Review `worker-configuration.d.ts` if you modified `wrangler.toml`

### Adding New API Endpoints

1. Add route handling in the main fetch handler in `src/index.ts`
2. Define TypeScript interfaces for request/response types
3. Update the `Env` interface if new bindings are needed
4. Run `pnpm build` to verify compilation
5. Add corresponding HTML templates to `public/` if needed

### Modifying Cloudflare Bindings

1. Update `wrangler.toml` with new bindings
2. **ALWAYS** run `pnpm generate-types` immediately after changes
3. Update `src/index.ts` to use new bindings via the `env` parameter
4. Run `pnpm typecheck` to verify types are correct

### Template Modifications

1. Edit files in `public/` directory
2. Templates use handlebars-style placeholders: `{{variable_name}}`
3. **NO BUILD REQUIRED** for template changes
4. Test template rendering by checking API responses

## Dependencies and Requirements

### Node.js and Package Manager

- **Node.js**: Version 20+ (v20.19.4 tested)
- **Package Manager**: pnpm (required, not npm)
- **TypeScript**: ^5.4.0 (configured for ES2022 target)
- **Wrangler**: ^3.61.0 (Cloudflare Workers CLI)

### Installation Commands

```bash
# If pnpm is not available
npm install -g pnpm

# Project dependencies (run from repo root)
pnpm install
```

## Troubleshooting

### Build Failures

**Problem**: `pnpm build` fails with type errors
**Solution**: 
1. Run `pnpm generate-types` first
2. Check `worker-configuration.d.ts` exists and is current
3. Verify `wrangler.toml` syntax is correct

**Problem**: Missing Cloudflare Worker types
**Solution**: 
1. Never import `@cloudflare/workers-types` directly in app code
2. Always use generated types from `pnpm generate-types`
3. Ensure `tsconfig.json` references `worker-configuration.d.ts`

### Development Server Issues

**Problem**: Local dev server fails with Browser Rendering error
**Solution**: This is expected. Use `pnpm build` for validation instead.

**Problem**: "You must be logged in" error
**Solution**: Remote development requires Cloudflare authentication. Focus on build validation.

### Type Checking Issues

**Problem**: TypeScript errors about missing globals
**Solution**:
1. Run `pnpm generate-types` to refresh types
2. Check `tsconfig.json` includes correct types array
3. Verify `compatibility_date` in `wrangler.toml` is recent

## Performance and Optimization

### Build Performance
- Type generation: ~1 second
- TypeScript compilation: ~1 second  
- Total build time: ~2 seconds

### Runtime Characteristics
- **Cold Start**: ~10-50ms (typical for Workers)
- **API Response Time**: 1-5 seconds (depends on AI model)
- **Memory Usage**: ~128MB (Worker default)

## Testing Strategy

### No Automated Tests Available
**CRITICAL**: This repository has no existing test infrastructure. Do not add testing frameworks as part of minimal changes.

### Manual Validation Requirements
**ALWAYS** validate changes through:
1. Successful build: `pnpm build`
2. Type checking: `pnpm typecheck` 
3. Code review of generated `worker-configuration.d.ts`
4. Template validation for placeholder consistency

### Change Validation Checklist
After any modification, verify:
- [ ] `pnpm generate-types` succeeds
- [ ] `pnpm typecheck` passes with no errors
- [ ] `pnpm build` completes successfully
- [ ] No breaking changes to API interfaces
- [ ] HTML templates maintain required placeholders
- [ ] `worker-configuration.d.ts` reflects any wrangler.toml changes

## Important Notes

### DO NOT Attempt
- **Local API testing**: Requires Cloudflare authentication
- **Running development server**: Browser Rendering blocks local development
- **Adding test frameworks**: Outside scope of minimal changes
- **Modifying .agents/ directory**: Separate from main application

### ALWAYS Do
- **Run builds after every change**: Immediate feedback on compilation
- **Generate types after wrangler.toml changes**: Keeps types synchronized
- **Use pnpm, not npm**: Project configured for pnpm workspaces
- **Wait for commands to complete**: Even fast commands should not be cancelled

### Timeout Recommendations
- **pnpm install**: 10+ minutes
- **pnpm build**: 60+ seconds (safety margin)
- **pnpm typecheck**: 60+ seconds (safety margin)
- **pnpm generate-types**: 30+ seconds (safety margin)

**NEVER CANCEL** any of these operations, even if they appear to hang.