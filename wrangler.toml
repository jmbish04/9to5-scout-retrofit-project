name = "9to5-scout"
main = "src/index.ts"
compatibility_date = "2024-05-01"
compatibility_flags = ["nodejs_compat"]

[vars]
DEFAULT_MODEL_WEB_BROWSER = "@cf/meta/llama-4-scout-17b-16e-instruct"

[observability.logs]
enabled = true

[browser]
binding = "MYBROWSER"

[[d1_databases]]
binding = "DB"
database_name = "JOB_SCRAPER_DB"
database_id = "11092798-a3d9-44b8-be5f-1835c0027887"

[[kv_namespaces]]
binding = "KV"
id = "5e60b00818e9448b8f965af0fc96d39a"

[[kv_namespaces]]
binding = "USAGE_TRACKER"
id = "d78887786a634316a921a869c2e406e8"
preview_id = "0900decc2f2043f4a5591eda43562065"

[[r2_buckets]]
binding = "R2"
bucket_name = "job-scraper"

[[vectorize]]
binding = "VECTORIZE_INDEX"
index_name = "jobs"

[ai]
binding = "AI"

# Configuration for receiving emails sent to your domain
[[email]]
name = "EMAIL_INBOX"
destination_addresses = ["job-alerts@hacolby.app"]

# Configuration for sending emails from your worker
# This must be a verified sender address in your Cloudflare account
[[send_email]]
name = "EMAIL_SENDER"
destination_address = "justin@126colby.com"

[[services]]
binding = "SERVICE"
service = "9to5-scout"

[durable_objects]
bindings = [
  { name = "SITE_CRAWLER", class_name = "SiteCrawler" },
  { name = "JOB_MONITOR", class_name = "JobMonitor" },
  { name = "SCRAPE_SOCKET", class_name = "ScrapeSocket" }
]

[[workflows]]
name = "discovery-workflow"
binding = "DISCOVERY_WORKFLOW"
class_name = "DiscoveryWorkflow"

[[workflows]]
name = "job-monitor-workflow"
binding = "JOB_MONITOR_WORKFLOW"
class_name = "JobMonitorWorkflow"

[[workflows]]
name = "change-analysis-workflow"
binding = "CHANGE_ANALYSIS_WORKFLOW"
class_name = "ChangeAnalysisWorkflow"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["SiteCrawler", "JobMonitor"]

[[migrations]]
tag = "v2"
new_classes = ["ScrapeSocket"]


[triggers]
crons = [
  "*/15 * * * *", # every 15 minutes
  "0 6 * * *"     # daily 06:00
]

[assets]
binding = "ASSETS"
directory = "./public"

